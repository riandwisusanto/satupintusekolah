import{b as e,B as a,w as l,r as t,c as o,o as s,j as i,h as d,f as n,g as u,a as r,y as c,m as p,u as m,p as b,F as v}from"./vue-CzxLGHcz.js";import{c as h,g as f,a as y,e as g,b as V}from"./app-CFGDmtZY.js";const w={key:0},k={__name:"form",props:{selected:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(r,{expose:c,emit:p}){const m=r,b=p,v=e({get:()=>m.visible,set:e=>b("update:visible",e)});const h=a({id:null,name:"",phone:"",nip:"",email:"",photo:null,active:!0});function f(){Object.assign(h,{id:null,name:"",phone:"",nip:"",email:"",photo:null,active:!0})}function y(){b("save",{...h})}return l(()=>m.visible,e=>{var a;e&&m.selected?(a=m.selected)&&Object.assign(h,{...a,active:1==a.active,photo:a.photo||null}):e||f()}),c({close:function(){b("update:visible",!1),f()}}),(e,a)=>{const l=t("FormInput"),c=t("FormInputPhone"),p=t("FormInputNIP"),m=t("FormSelectRole"),b=t("FileUpload"),f=t("FormToggleStatus"),g=t("FormDrawer");return s(),o(g,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=e=>v.value=e),title:r.selected?"Ubah Pengguna":"Tambah Pengguna",width:"500",onSave:y},{default:i(()=>[d(l,{modelValue:h.name,"onUpdate:modelValue":a[0]||(a[0]=e=>h.name=e),label:"Nama",required:""},null,8,["modelValue"]),d(l,{type:"email",modelValue:h.email,"onUpdate:modelValue":a[1]||(a[1]=e=>h.email=e),label:"Email",required:""},null,8,["modelValue"]),d(c,{modelValue:h.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>h.phone=e),label:"No. HP"},null,8,["modelValue"]),d(p,{modelValue:h.nip,"onUpdate:modelValue":a[3]||(a[3]=e=>h.nip=e),label:"NIP"},null,8,["modelValue"]),d(m,{modelValue:h.role_id,"onUpdate:modelValue":a[4]||(a[4]=e=>h.role_id=e),label:"Role",required:""},null,8,["modelValue"]),d(l,{modelValue:h.password,"onUpdate:modelValue":a[5]||(a[5]=e=>h.password=e),label:h.id?"Password Baru":"Password",type:"password",required:!h.id},null,8,["modelValue","label","required"]),h.id?(s(),n("small",w,"* Biarkan kosong jika tidak ubah password")):u("",!0),d(b,{modelValue:h.photo,"onUpdate:modelValue":a[6]||(a[6]=e=>h.photo=e),label:"Foto",accept:"jpeg,jpg,png",required:!h.id,class:"mt-3"},null,8,["modelValue","required"]),d(f,{modelValue:h.active,"onUpdate:modelValue":a[7]||(a[7]=e=>h.active=e)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])}}},P={class:"content"},j=["src"],U={key:1,class:"text-muted"},_={class:"btn-group"},F=["onClick"],x=["onClick"],N={__name:"index",setup(e){const a=r(),{checkPermission:l}=h(),o=r(!1),w=r(null),N=r(!1),S={1:{text:"Aktif",class:"badge-success"},0:{text:"Tidak Aktif",class:"badge-danger"}},q=[{field:"id",display:"#ID"},{field:"email",display:"Email"},{field:"name",display:"Nama"},{field:"nip",display:"NIP"},{field:"phone",display:"No HP"},{field:"photo",display:"Foto"},{field:"active",display:"Status"},{field:"action",display:"Action",sortable:!1}],C=()=>{w.value=null,o.value=!0};const D=async e=>{f("save").then(async a=>{a.isConfirmed&&I(e)})},I=async e=>{var l;N.value=!0;const{type:t,body:s}=function(e){if(!(e.photo instanceof File))return delete e.photo,{type:"json",body:{...e}};const a=new FormData;return e.id&&a.append("_method","PUT"),Object.keys(e).forEach(l=>{a.append(l,e[l])}),{type:"formdata",body:a}}(e),{ok:i,data:d,error:n}=await y("users"+(e.id?`/${e.id}`:""),{method:"json"===t&&e.id?"put":"post",body:s,headers:"json"===t?{}:{"Content-Type":"multipart/form-data"}});i?(g("Data berhasil disimpan"),o.value=!1,null==(l=a.value)||l.reload()):V(n),N.value=!1};return(e,r)=>{const h=t("StatusTag"),I=t("TableServerSide");return s(),n(v,null,[r[3]||(r[3]=c('<section class="content-header"><div class="container-fluid"><div class="row"><div class="col-sm-6"><h4 class="font-serif-formal">Data Pengguna</h4></div><div class="col-sm-6"><ol class="breadcrumb float-sm-right"><li class="breadcrumb-item"><a href="#">Pengguna</a></li><li class="breadcrumb-item active">Data Pengguna</li></ol></div></div></div></section>',1)),p("section",P,[d(I,{ref_key:"tableRef",ref:a,title:"","show-add-button":m(l)("master_data.users.create"),"show-drawer":!0,columns:q,"initial-sort":{field:"id",order:"desc"},per_page:10,endpoint:"users",loading:N.value,onOpenDrawer:C},{"cell-photo":i(({row:e})=>[e.photo?(s(),n("img",{key:0,src:`${e.photo}`,alt:"User Photo",class:"rounded-circle",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,j)):(s(),n("span",U,"No Photo"))]),"cell-active":i(({row:e})=>[d(h,{status:e.active,map:S},null,8,["status"])]),"cell-action":i(({row:e})=>[p("div",_,[m(l)("master_data.users.update")&&1==e.editable?(s(),n("button",{key:0,class:"btn btn-primary btn-sm",type:"button",onClick:b(a=>(e=>{w.value=e,o.value=!0})(e),["stop","prevent"])},[...r[1]||(r[1]=[p("i",{class:"fas fa-edit"},null,-1)])],8,F)):u("",!0),m(l)("master_data.users.delete")&&1==e.deletable?(s(),n("button",{key:1,class:"btn btn-danger btn-sm",type:"button",onClick:b(l=>(async e=>{f("delete").then(async l=>{var t;if(l.isConfirmed){const{ok:l,data:o,error:s}=await y(`users/${e}`,{method:"delete"});l?(g(o.message),null==(t=a.value)||t.reload()):V(s)}})})(e.id),["stop","prevent"])},[...r[2]||(r[2]=[p("i",{class:"fas fa-trash"},null,-1)])],8,x)):u("",!0)])]),_:1},8,["show-add-button","loading"])]),d(k,{visible:o.value,"onUpdate:visible":r[0]||(r[0]=e=>o.value=e),selected:w.value,onSave:D},null,8,["visible","selected"])],64)}}};export{N as default};
