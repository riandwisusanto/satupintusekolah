import{K as e,a,b as l,w as t,f as n,g as r,s as u,i as o,t as i,q as s,x as d,Y as v,n as p,o as c}from"./vue-3FdbM0aa.js";import{_ as m,a as f}from"./app-dRKbozfU.js";const y=["for"],b={key:0,class:"text-danger"},g={key:0},h={key:1},S=["name","value"],x={key:2,class:"form-text text-danger"},I={key:3,class:"form-text text-muted"},k={key:4,class:"form-text text-danger"},A=m({__name:"SelectServerSide",props:{modelValue:[String,Number],label:String,name:String,id:String,required:Boolean,disabled:Boolean,placeholder:String,options:{type:Array,default:()=>[]},serverside:Boolean,endpoint:String,fetchOptions:Function,labelKey:{type:String,default:"name"},valueKey:{type:String,default:"id"},wrapperClass:{type:String,default:"form-group"},help:String,error:String,excludeId:[String,Number],labelFormatter:{type:Function,default:null},teleport:{type:String,default:void 0}},emits:["update:modelValue","load","select"],setup(m,{expose:A,emit:K}){const F=m,w=K;let V=!0;e(()=>{V=!1});const _=a(null);function q(e){e.preventDefault(),_.value="Field wajib diisi."}const O=l(()=>_.value),$=a(null);t($,e=>{w("update:modelValue",e);const a=(F.serverside?C.value:F.options).find(a=>a.value===e);w("select",a||null)}),t(()=>F.modelValue,e=>{$.value=e},{immediate:!0}),t($,()=>{_.value=null});const j=l(()=>F.id||F.name||`select-${Math.random().toString(36).slice(2)}`),B=a(!1),C=a([]),N=a(""),E=a(""),L=a([]),T=l(()=>"function"==typeof F.fetchOptions?F.fetchOptions:F.endpoint?async(e="")=>{const a=F.endpoint.includes("?"),l=`${F.endpoint}${a?"&":"?"}search=${encodeURIComponent(e)}`,{ok:t,data:n}=await f(l);if(!t)return[];return(Array.isArray(null==n?void 0:n.data)?n.data:Array.isArray(n)?n:[]).map(e=>({...e,label:e[F.labelKey]??e.name??e.id,value:e[F.valueKey]??e.id}))}:null);async function U(e=""){if(!F.serverside)return;if(!T.value||"function"!=typeof T.value)return;const a=e||E.value||"";B.value=!0;try{const e=await T.value(a);if(!V)return;const l=(Array.isArray(e)?e:[]).map(e=>({...e,label:F.labelFormatter?F.labelFormatter(e):e[F.labelKey]??e.label??e.id,value:e[F.valueKey]??e.value??e.id})).filter(e=>e.value!==F.excludeId),t=[...L.value];l.forEach(e=>{t.some(a=>a.value===e.value)||t.push(e)}),C.value=t,w("load",C.value)}finally{V&&(B.value=!1)}}let D=null;const M=e=>{""===e&&""!==N.value||(N.value=e,E.value=e,F.serverside&&T.value&&"function"==typeof T.value&&(D&&clearTimeout(D),D=setTimeout(async()=>{B.value=!0;try{const a=await T.value(e);if(!V)return;const l=(Array.isArray(a)?a:[]).map(e=>({...e,label:F.labelFormatter?F.labelFormatter(e):e[F.labelKey]??e.label??e.id,value:e[F.valueKey]??e.value??e.id})).filter(e=>e.value!==F.excludeId),t=[...L.value];l.forEach(e=>{t.some(a=>a.value===e.value)||t.push(e)}),C.value=t}finally{V&&(B.value=!1)}},300)))};return t(()=>F.excludeId,()=>{U()},{immediate:!0}),A({ensureLoaded:U,ensureInitialOption:function(e){if(!e)return;const a=L.value.findIndex(a=>a.value===e.value);-1===a?L.value.push(e):L.value[a]=e;const l=C.value.findIndex(a=>a.value===e.value);-1===l?C.value=[...C.value,e]:C.value[l]=e}}),(e,a)=>(c(),n("div",{class:p(m.wrapperClass)},[m.label?(c(),n("label",{key:0,for:j.value,class:"form-label"},[o(i(m.label),1),m.required?(c(),n("span",b,"*")):r("",!0)],8,y)):r("",!0),u(d(v),{id:j.value,modelValue:$.value,"onUpdate:modelValue":a[0]||(a[0]=e=>$.value=e),name:m.name,options:m.serverside?C.value:m.options,placeholder:m.placeholder,"is-disabled":m.disabled,"is-loading":B.value,reduce:e=>e.value,teleport:m.teleport,label:"label",onOpen:U,onSearch:M},{"no-options":s(()=>[B.value?(c(),n("div",g,"Loading...")):(c(),n("div",h,"No options found."))]),_:1},8,["id","modelValue","name","options","placeholder","is-disabled","is-loading","reduce","teleport"]),m.required?(c(),n("input",{key:1,type:"text",name:m.name,value:$.value,required:"",style:{position:"absolute",opacity:"0",height:"0","pointer-events":"none"},onInvalid:q},null,40,S)):r("",!0),O.value?(c(),n("small",x,i(O.value),1)):r("",!0),m.help?(c(),n("small",I,i(m.help),1)):r("",!0),m.error?(c(),n("small",k,i(m.error),1)):r("",!0)],2))}},[["__scopeId","data-v-bda6cfa1"]]);export{A as default};
