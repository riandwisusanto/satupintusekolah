import{N as e,a,b as l,w as t,f as n,g as r,s as u,i as o,t as i,q as s,x as d,Y as v,n as p,o as c}from"./vue-DNxxE8NJ.js";import{_ as m,a as f}from"./app-YK7FhtRg.js";const y=["for"],b={key:0,class:"text-danger"},g={key:0},h={key:1},S=["name","value"],x={key:2,class:"form-text text-danger"},I={key:3,class:"form-text text-muted"},k={key:4,class:"form-text text-danger"},A=m({__name:"SelectServerSide",props:{modelValue:[String,Number],label:String,name:String,id:String,required:Boolean,disabled:Boolean,placeholder:String,options:{type:Array,default:()=>[]},serverside:Boolean,endpoint:String,fetchOptions:Function,labelKey:{type:String,default:"name"},valueKey:{type:String,default:"id"},wrapperClass:{type:String,default:"form-group"},help:String,error:String,excludeId:[String,Number],labelFormatter:{type:Function,default:null},teleport:{type:String,default:void 0}},emits:["update:modelValue","load","select"],setup(m,{expose:A,emit:F}){const K=m,w=F;let V=!0;e(()=>{V=!1});const _=a(null);function q(e){e.preventDefault(),_.value="Field wajib diisi."}const O=l(()=>_.value),N=a(null);t(N,e=>{w("update:modelValue",e);const a=(K.serverside?B.value:K.options).find(a=>a.value===e);w("select",a||null)}),t(()=>K.modelValue,e=>{N.value=e},{immediate:!0}),t(N,()=>{_.value=null});const $=l(()=>K.id||K.name||`select-${Math.random().toString(36).slice(2)}`),j=a(!1),B=a([]),C=a(""),E=a(""),L=a([]),T=l(()=>"function"==typeof K.fetchOptions?K.fetchOptions:K.endpoint?async(e="")=>{const a=K.endpoint.includes("?"),l=`${K.endpoint}${a?"&":"?"}search=${encodeURIComponent(e)}`,{ok:t,data:n}=await f(l);if(!t)return[];return(Array.isArray(null==n?void 0:n.data)?n.data:Array.isArray(n)?n:[]).map(e=>({...e,label:e[K.labelKey]??e.name??e.id,value:e[K.valueKey]??e.id}))}:null);async function U(e=""){if(!K.serverside)return;if(!T.value||"function"!=typeof T.value)return;const a=e||E.value||"";j.value=!0;try{const e=await T.value(a);if(!V)return;const l=(Array.isArray(e)?e:[]).map(e=>({...e,label:K.labelFormatter?K.labelFormatter(e):e[K.labelKey]??e.label??e.id,value:e[K.valueKey]??e.value??e.id})).filter(e=>e.value!==K.excludeId),t=[...L.value];l.forEach(e=>{t.some(a=>a.value===e.value)||t.push(e)}),B.value=t,w("load",B.value)}finally{V&&(j.value=!1)}}let D=null;const M=e=>{""===e&&""!==C.value||(C.value=e,E.value=e,K.serverside&&T.value&&"function"==typeof T.value&&(D&&clearTimeout(D),D=setTimeout(async()=>{j.value=!0;try{const a=await T.value(e);if(!V)return;const l=(Array.isArray(a)?a:[]).map(e=>({...e,label:K.labelFormatter?K.labelFormatter(e):e[K.labelKey]??e.label??e.id,value:e[K.valueKey]??e.value??e.id})).filter(e=>e.value!==K.excludeId),t=[...L.value];l.forEach(e=>{t.some(a=>a.value===e.value)||t.push(e)}),B.value=t}finally{V&&(j.value=!1)}},300)))};return t(()=>K.excludeId,()=>{U()},{immediate:!0}),A({ensureLoaded:U,ensureInitialOption:function(e){if(!e)return;const a=L.value.findIndex(a=>a.value===e.value);-1===a?L.value.push(e):L.value[a]=e;const l=B.value.findIndex(a=>a.value===e.value);-1===l?B.value=[...B.value,e]:B.value[l]=e}}),(e,a)=>(c(),n("div",{class:p(m.wrapperClass)},[m.label?(c(),n("label",{key:0,for:$.value,class:"form-label"},[o(i(m.label),1),m.required?(c(),n("span",b,"*")):r("",!0)],8,y)):r("",!0),u(d(v),{id:$.value,modelValue:N.value,"onUpdate:modelValue":a[0]||(a[0]=e=>N.value=e),name:m.name,options:m.serverside?B.value:m.options,placeholder:m.placeholder,"is-disabled":m.disabled,"is-loading":j.value,reduce:e=>e.value,teleport:m.teleport,label:"label",onOpen:U,onSearch:M},{"no-options":s(()=>[j.value?(c(),n("div",g,"Loading...")):(c(),n("div",h,"No options found."))]),_:1},8,["id","modelValue","name","options","placeholder","is-disabled","is-loading","reduce","teleport"]),m.required?(c(),n("input",{key:1,type:"text",name:m.name,value:N.value,required:"",style:{position:"absolute",opacity:"0",height:"0","pointer-events":"none"},onInvalid:q},null,40,S)):r("",!0),O.value?(c(),n("small",x,i(O.value),1)):r("",!0),m.help?(c(),n("small",I,i(m.help),1)):r("",!0),m.error?(c(),n("small",k,i(m.error),1)):r("",!0)],2))}},[["__scopeId","data-v-bda6cfa1"]]);export{A as default};
