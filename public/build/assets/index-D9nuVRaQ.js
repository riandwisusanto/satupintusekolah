import{b as e,p as a,w as l,r as t,c as o,o as s,q as d,s as i,f as n,g as u,a as r,m as c,h as p,x as m,j as b,F as v}from"./vue-DNxxE8NJ.js";import{c as f,f as h,a as y,d as g,b as V}from"./app-laDEkNiO.js";const w={key:0},k={__name:"form",props:{selected:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(r,{expose:c,emit:p}){const m=r,b=p,v=e({get:()=>m.visible,set:e=>b("update:visible",e)});const f=a({id:null,name:"",phone:"",nip:"",email:"",photo:null,active:!0});function h(){Object.assign(f,{id:null,name:"",phone:"",nip:"",email:"",photo:null,active:!0})}function y(){b("save",{...f})}return l(()=>m.visible,e=>{var a;e&&m.selected?(a=m.selected)&&Object.assign(f,{...a,active:1==a.active,photo:a.photo||null}):e||h()}),c({close:function(){b("update:visible",!1),h()}}),(e,a)=>{const l=t("FormInput"),c=t("FormInputPhone"),p=t("FormInputNIP"),m=t("FormSelectRole"),b=t("FileUpload"),h=t("FormToggleStatus"),g=t("FormDrawer");return s(),o(g,{modelValue:v.value,"onUpdate:modelValue":a[8]||(a[8]=e=>v.value=e),title:r.selected?"Ubah Pengguna":"Tambah Pengguna",width:"500",onSave:y},{default:d(()=>[i(l,{modelValue:f.name,"onUpdate:modelValue":a[0]||(a[0]=e=>f.name=e),label:"Nama",required:""},null,8,["modelValue"]),i(l,{type:"email",modelValue:f.email,"onUpdate:modelValue":a[1]||(a[1]=e=>f.email=e),label:"Email",required:""},null,8,["modelValue"]),i(c,{modelValue:f.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>f.phone=e),label:"No. HP"},null,8,["modelValue"]),i(p,{modelValue:f.nip,"onUpdate:modelValue":a[3]||(a[3]=e=>f.nip=e),label:"NIP"},null,8,["modelValue"]),i(m,{modelValue:f.role_id,"onUpdate:modelValue":a[4]||(a[4]=e=>f.role_id=e),label:"Role",required:""},null,8,["modelValue"]),i(l,{modelValue:f.password,"onUpdate:modelValue":a[5]||(a[5]=e=>f.password=e),label:f.id?"Password Baru":"Password",type:"password",required:!f.id},null,8,["modelValue","label","required"]),f.id?(s(),n("small",w,"* Biarkan kosong jika tidak ubah password")):u("",!0),i(b,{modelValue:f.photo,"onUpdate:modelValue":a[6]||(a[6]=e=>f.photo=e),label:"Foto",accept:"jpeg,jpg,png",required:!f.id,class:"mt-3"},null,8,["modelValue","required"]),i(h,{modelValue:f.active,"onUpdate:modelValue":a[7]||(a[7]=e=>f.active=e)},null,8,["modelValue"])]),_:1},8,["modelValue","title"])}}},P={class:"content"},j=["src"],U={key:1,class:"text-muted"},_={class:"btn-group"},F=["onClick"],x=["onClick"],q={__name:"index",setup(e){const a=r(),{checkPermission:l}=f(),o=r(!1),w=r(null),q=r(!1),N={1:{text:"Aktif",class:"badge-success"},0:{text:"Tidak Aktif",class:"badge-danger"}},S=[{field:"id",display:"#ID"},{field:"email",display:"Email"},{field:"name",display:"Nama"},{field:"nip",display:"NIP"},{field:"phone",display:"No HP"},{field:"photo",display:"Foto"},{field:"active",display:"Status"},{field:"action",display:"Action",sortable:!1}],C=()=>{w.value=null,o.value=!0};const D=async e=>{h("save").then(async a=>{a.isConfirmed&&I(e)})},I=async e=>{var l;q.value=!0;const{type:t,body:s}=function(e){if(!(e.photo instanceof File))return delete e.photo,{type:"json",body:{...e}};const a=new FormData;return e.id&&a.append("_method","PUT"),Object.keys(e).forEach(l=>{a.append(l,e[l])}),{type:"formdata",body:a}}(e),{ok:d,data:i,error:n}=await y("users"+(e.id?`/${e.id}`:""),{method:"json"===t&&e.id?"put":"post",body:s,headers:"json"===t?{}:{"Content-Type":"multipart/form-data"}});d?(g("Data berhasil disimpan"),o.value=!1,null==(l=a.value)||l.reload()):V(n),q.value=!1};return(e,r)=>{const f=t("StatusTag"),I=t("TableServerSide");return s(),n(v,null,[r[3]||(r[3]=c('<section class="content-header"><div class="container-fluid"><div class="row"><div class="col-sm-6"><h4 class="font-serif-formal">Data Pengguna</h4></div><div class="col-sm-6"><ol class="breadcrumb float-sm-right"><li class="breadcrumb-item"><a href="#">Pengguna</a></li><li class="breadcrumb-item active">Data Pengguna</li></ol></div></div></div></section>',1)),p("section",P,[i(I,{ref_key:"tableRef",ref:a,title:"","show-add-button":m(l)("master_data.users.create"),"show-drawer":!0,columns:S,"initial-sort":{field:"id",order:"desc"},per_page:10,endpoint:"users",loading:q.value,onOpenDrawer:C},{"cell-photo":d(({row:e})=>[e.photo?(s(),n("img",{key:0,src:`${e.photo}`,alt:"User Photo",class:"rounded-circle",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,j)):(s(),n("span",U,"No Photo"))]),"cell-active":d(({row:e})=>[i(f,{status:e.active,map:N},null,8,["status"])]),"cell-action":d(({row:e})=>[p("div",_,[m(l)("master_data.users.update")&&1==e.editable?(s(),n("button",{key:0,class:"btn btn-primary btn-sm",type:"button",onClick:b(a=>(e=>{w.value=e,o.value=!0})(e),["stop","prevent"])},[...r[1]||(r[1]=[p("i",{class:"fas fa-edit"},null,-1)])],8,F)):u("",!0),m(l)("master_data.users.delete")&&1==e.deletable?(s(),n("button",{key:1,class:"btn btn-danger btn-sm",type:"button",onClick:b(l=>(async e=>{h("delete").then(async l=>{var t;if(l.isConfirmed){const{ok:l,data:o,error:s}=await y(`users/${e}`,{method:"delete"});l?(g(o.message),null==(t=a.value)||t.reload()):V(s)}})})(e.id),["stop","prevent"])},[...r[2]||(r[2]=[p("i",{class:"fas fa-trash"},null,-1)])],8,x)):u("",!0)])]),_:1},8,["show-add-button","loading"])]),i(k,{visible:o.value,"onUpdate:visible":r[0]||(r[0]=e=>o.value=e),selected:w.value,onSave:D},null,8,["visible","selected"])],64)}}};export{q as default};
