import{_ as a,u as t,g as l,h as s,a as e}from"./app-dRKbozfU.js";import{d as o}from"./dayjs.min-ViwXrfnO.js";import{a as i,b as n,e as c,f as d,m as r,h as u,g as b,t as v,n as f,i as h,F as p,l as m,x as y,s as k,q as _,r as g,o as C}from"./vue-3FdbM0aa.js";const w={class:"content"},Y={class:"container-fluid"},$={class:"row mb-4"},T={class:"col-lg-4 col-6"},I={class:"small-box bg-info"},x={class:"inner"},M={class:"col-lg-4 col-6"},O={class:"small-box bg-success"},D={class:"inner"},F={class:"col-lg-4 col-6"},j={class:"small-box bg-primary"},A={class:"inner"},S={class:"row mb-3"},H={class:"col-12"},L={class:"btn-group",role:"group"},B={key:0,class:"text-center"},z={key:1,class:"card"},V={class:"card-body p-0"},q={key:0,class:"alert alert-info m-3"},K={key:1,class:"table-responsive"},P={class:"table table-hover"},R={class:"badge badge-secondary"},E={class:"btn-group btn-group-sm"},G=["onClick"],J=["onClick"],N={key:0,class:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)","z-index":"9999"}},Q={class:"modal-dialog modal-lg"},U={class:"modal-content"},W={class:"modal-body"},X=["src"],Z={key:1},aa=["src"],ta={key:1},la={key:1,class:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.8)","z-index":"9999"}},sa={class:"modal-dialog modal-md"},ea={class:"modal-content"},oa={class:"modal-header"},ia={class:"modal-title"},na={class:"modal-body text-center"},ca={class:"photo-container"},da=["src","alt"],ra={class:"photo-info mt-3"},ua=a({__name:"history",setup(a){const ua=i(),ba=i(!1),va=i([]),fa=i(!1),ha=i("recent"),{user:pa}=t(),ma=i({total_days:0,absent_days:0,attendance_rate:0}),ya=n(()=>va.value.slice(0,7)),ka=[{field:"date",display:"Tanggal",sortable:!0},{field:"time_in",display:"In",sortable:!0},{field:"time_out",display:"Out",sortable:!0},{field:"photo_in",display:"Foto In",sortable:!1},{field:"photo_out",display:"Foto Out",sortable:!1}],_a=(a,t)=>{if(!a||!t)return"-";const l=o(`${o().format("YYYY-MM-DD")}T${a}`),s=o(`${o().format("YYYY-MM-DD")}T${t}`);if(!l.isValid()||!s.isValid())return"-";const e=s.diff(l,"minute");return`${Math.floor(e/60)}j ${e%60}m`},ga=()=>{ba.value=!0},Ca=()=>{ba.value=!1},wa=i(!1),Ya=i({url:"",type:"",date:""}),$a=a=>{Ya.value={url:`/storage/${a.photo}`,type:a.type,date:a.date||(new Date).toISOString()},wa.value=!0},Ta=()=>{wa.value=!1,Ya.value={url:"",type:"",date:""}},Ia=()=>{(async()=>{try{const{ok:a,data:t}=await e(`teacher-attendances/monthly-report?month=${o().format("YYYY-MM")}`);if(a){const{statistics:a}=t.data;ma.value={total_days:a.total_days,absent_days:a.absent_days,attendance_rate:a.total_days>0?(a.total_days-a.absent_days)/a.total_days*100:0}}}catch(a){}})(),(async()=>{fa.value=!0;try{const{ok:a,data:t}=await e(`teacher-attendances/history/${pa.user.id}?per_page=7&sort_field=date&sort_order=desc`);a&&t.data&&(va.value=t.data)}catch(a){}finally{fa.value=!1}})()};return c(()=>{Ia()}),(a,t)=>{const e=g("TableServerSide");return C(),d(p,null,[t[20]||(t[20]=r('<section class="content-header" data-v-fb7cbfc0><div class="container-fluid" data-v-fb7cbfc0><div class="row" data-v-fb7cbfc0><div class="col-sm-6" data-v-fb7cbfc0><h4 data-v-fb7cbfc0>History Absensi</h4></div><div class="col-sm-6" data-v-fb7cbfc0><ol class="breadcrumb float-sm-right" data-v-fb7cbfc0><li class="breadcrumb-item" data-v-fb7cbfc0><a href="#" data-v-fb7cbfc0>Absensi</a></li><li class="breadcrumb-item active" data-v-fb7cbfc0>History</li></ol></div></div></div></section>',1)),u("section",w,[u("div",Y,[u("div",$,[u("div",T,[u("div",I,[u("div",x,[u("h3",null,v(ma.value.total_days),1),t[0]||(t[0]=u("p",null,"Hadir Bulan Ini",-1))]),t[1]||(t[1]=u("div",{class:"icon"},[u("i",{class:"fas fa-calendar-check"})],-1))])]),u("div",M,[u("div",O,[u("div",D,[u("h3",null,v(ma.value.absent_days||0),1),t[2]||(t[2]=u("p",null,"Tidak Hadir",-1))]),t[3]||(t[3]=u("div",{class:"icon"},[u("i",{class:"fas fa-user-times"})],-1))])]),u("div",F,[u("div",j,[u("div",A,[u("h3",null,v(ma.value.attendance_rate||0)+"%",1),t[4]||(t[4]=u("p",null,"Tingkat Kehadiran",-1))]),t[5]||(t[5]=u("div",{class:"icon"},[u("i",{class:"fas fa-percentage"})],-1))])])]),u("div",S,[u("div",H,[u("div",L,[u("button",{onClick:Ia,class:f(["btn btn-default",{"btn-primary":"recent"===ha.value}])},[...t[6]||(t[6]=[u("i",{class:"fas fa-history"},null,-1),h(" Terkini ",-1)])],2),u("button",{onClick:ga,class:"btn btn-default"},[...t[7]||(t[7]=[u("i",{class:"fas fa-list"},null,-1),h(" Lihat Semua ",-1)])])])])]),fa.value?(C(),d("div",B,[...t[8]||(t[8]=[u("i",{class:"fas fa-spinner fa-spin"},null,-1),h(" Memuat data... ",-1)])])):(C(),d("div",z,[t[13]||(t[13]=u("div",{class:"card-header"},[u("h3",{class:"card-title"},[u("i",{class:"fas fa-clock"}),h(" Aktivitas Terkini (7 hari terakhir) ")])],-1)),u("div",V,[0===ya.value.length?(C(),d("div",q,[...t[9]||(t[9]=[u("i",{class:"fas fa-info-circle"},null,-1),h(" Belum ada data absensi untuk 7 hari terakhir. ",-1)])])):(C(),d("div",K,[u("table",P,[t[12]||(t[12]=u("thead",{class:"thead-light"},[u("tr",null,[u("th",null,"Tanggal"),u("th",null,"In"),u("th",null,"Out"),u("th",null,"Durasi"),u("th",null,"Aksi")])],-1)),u("tbody",null,[(C(!0),d(p,null,m(ya.value,a=>(C(),d("tr",{key:a.id},[u("td",null,[u("span",R,v(y(l)(a.date)),1)]),u("td",null,v(y(s)(a.time_in)),1),u("td",null,v(y(s)(a.time_out)),1),u("td",null,v(a.work_duration||_a(a.time_in,a.time_out)),1),u("td",null,[u("div",E,[a.photo_in?(C(),d("button",{key:0,onClick:t=>$a({photo:a.photo_in,type:"in",date:a.date}),class:"btn btn-info btn-sm",title:"Lihat Foto Check-In"},[...t[10]||(t[10]=[u("i",{class:"fas fa-camera"},null,-1)])],8,G)):b("",!0),a.photo_out?(C(),d("button",{key:1,onClick:t=>$a({photo:a.photo_out,type:"out",date:a.date}),class:"btn btn-warning btn-sm",title:"Lihat Foto Check-Out"},[...t[11]||(t[11]=[u("i",{class:"fas fa-camera"},null,-1)])],8,J)):b("",!0)])])]))),128))])])]))])]))])]),ba.value?(C(),d("div",N,[u("div",Q,[u("div",U,[u("div",{class:"modal-header"},[t[15]||(t[15]=u("h4",{class:"modal-title"}," Detail Absensi Lengkap ",-1)),u("button",{type:"button",onClick:Ca,class:"close"},[...t[14]||(t[14]=[u("span",null,"×",-1)])])]),u("div",W,[k(e,{ref_key:"tableRef",ref:ua,title:"",columns:ka,endpoint:`teacher-attendances/history/${y(pa).user.id}`,"initial-sort":{field:"date",order:"desc"},per_page:10},{"cell-date":_(({row:a})=>[h(v(y(l)(a.date)),1)]),"cell-time_in":_(({row:a})=>[h(v(y(s)(a.time_in)),1)]),"cell-time_out":_(({row:a})=>[h(v(y(s)(a.time_out)),1)]),"cell-photo_in":_(({row:a})=>[a.photo_in?(C(),d("img",{key:0,src:`/storage/${a.photo_in}`,class:"mini-photo"},null,8,X)):(C(),d("span",Z,"-"))]),"cell-photo_out":_(({row:a})=>[a.photo_out?(C(),d("img",{key:0,src:`/storage/${a.photo_out}`,class:"mini-photo"},null,8,aa)):(C(),d("span",ta,"-"))]),_:1},8,["endpoint"])])])])])):b("",!0),wa.value?(C(),d("div",la,[u("div",sa,[u("div",ea,[u("div",oa,[u("h4",ia,[t[16]||(t[16]=u("i",{class:"fas fa-camera"},null,-1)),h(" "+v("in"===Ya.value.type?"Foto Check-In":"Foto Check-Out"),1)]),u("button",{type:"button",onClick:Ta,class:"close"},[...t[17]||(t[17]=[u("span",null,"×",-1)])])]),u("div",na,[u("div",ca,[u("img",{src:Ya.value.url,alt:("in"===Ya.value.type?"Check-In":"Check-Out")+" Photo",class:"attendance-photo-large"},null,8,da)]),u("div",ra,[u("p",null,[t[18]||(t[18]=u("strong",null,"Tipe:",-1)),h(" "+v("in"===Ya.value.type?"Check-In":"Check-Out"),1)]),u("p",null,[t[19]||(t[19]=u("strong",null,"Tanggal:",-1)),h(" "+v(y(l)(Ya.value.date)),1)])])])])])])):b("",!0)],64)}}},[["__scopeId","data-v-fb7cbfc0"]]);export{ua as default};
