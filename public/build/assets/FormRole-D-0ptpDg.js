import{b as e,a as l,r as a,f as s,o as n,s as t,h as o,i,t as d,q as u,g as c,F as r,l as m,c as p,T as v,p as b,w as f,j as _}from"./vue-DNxxE8NJ.js";import h from"./FormInput-I5eYFXmv.js";import{_ as y,a as k}from"./app-YK7FhtRg.js";const V={class:"mb-2"},g={key:0,class:"flex items-center gap-2"},x=["checked"],j={key:1},w={class:"flex items-center gap-2 font-semibold"},C={key:0},U={key:1},A=["checked","indeterminate"],O={key:0,class:"ms-6 mt-1 border-l border-gray-200 ps-2"},T=y({__name:"PermissionNode",props:{node:Object,modelValue:Array},emits:["update:modelValue"],setup(b,{emit:f}){const _=b,h=f,y=e(()=>!!_.node.value),k=e(()=>Array.isArray(_.node.children)&&_.node.children.length>0),T=l(!1),F=e(()=>_.modelValue.includes(_.node.value));function I(e){if(!e.children||!e.children.length)return e.value?[e.value]:[];let l=[];for(const a of e.children)l=l.concat(I(a));return e.value&&l.push(e.value),l}const N=e(()=>I(_.node)),P=e(()=>N.value.every(e=>_.modelValue.includes(e))),R=e(()=>N.value.some(e=>_.modelValue.includes(e)));function q(e){const l=[..._.modelValue],a=N.value;e.target.checked?a.forEach(e=>{l.includes(e)||l.push(e)}):a.forEach(e=>{const a=l.indexOf(e);-1!==a&&l.splice(a,1)}),h("update:modelValue",l)}return(e,l)=>{const f=a("PermissionNode",!0);return n(),s("div",V,[y.value?(n(),s("label",g,[o("input",{type:"checkbox",checked:F.value,onChange:q},null,40,x),i(" "+d(b.node.label),1)])):(n(),s("div",j,[o("div",w,[o("button",{type:"button",class:"text-gray-500 hover:text-gray-700 transition",onClick:l[0]||(l[0]=e=>T.value=!T.value)},[T.value?(n(),s("span",C,"▼")):(n(),s("span",U,"▶"))]),o("input",{type:"checkbox",checked:P.value,indeterminate:R.value&&!P.value,onChange:q},null,40,A),i(" "+d(b.node.label),1)])])),t(v,{name:"fade"},{default:u(()=>[T.value&&k.value?(n(),s("div",O,[(n(!0),s(r,null,m(b.node.children,e=>(n(),p(f,{key:e.value||e.label,node:e,"model-value":b.modelValue,"onUpdate:modelValue":l[1]||(l[1]=e=>h("update:modelValue",e))},null,8,["node","model-value"]))),128))])):c("",!0)]),_:1})])}}},[["__scopeId","data-v-8a0c6979"]]),F={__name:"PermissionTree",props:{permissions:Array,modelValue:Array},emits:["update:modelValue"],setup(e,{emit:l}){const a=l;return(l,t)=>(n(),s("div",null,[(n(!0),s(r,null,m(e.permissions,l=>(n(),p(T,{key:l.label,node:l,"model-value":e.modelValue,"onUpdate:modelValue":t[0]||(t[0]=e=>a("update:modelValue",e))},null,8,["node","model-value"]))),128))]))}},I={key:0,class:"drawer-panel card shadow-lg overflow-auto px-4 py-3"},N={class:"card-header d-flex justify-content-between align-items-center"},P={class:"mb-0"},R={class:"card-body"},q={class:"row"},B={class:"col-md-12"},E={class:"col-md-12"},S={class:"card-footer d-flex justify-content-end fixed-bottom"},z={type:"submit",class:"btn btn-primary"},D=y({__name:"FormRole",props:{selected:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible","save"],setup(a,{expose:i,emit:m}){const p=l([]);const y=e(()=>function(e){const l={},a={};for(const s of e)a[s.name]=s.label;for(const s of e){const e=s.name.split("."),n=(a[s.name]||"").split(" ");let t=l;for(let l=0;l<e.length;l++){const a=e[l];e.slice(0,l+1).join(".");const o=n[l].split("_").join(" ")||a.charAt(0).toUpperCase()+a.slice(1);t[a]||(t[a]={__meta__:{label:o,value:l===e.length-1?s.name:null},__children__:{}}),t=t[a].__children__}}return function e(l){return Object.entries(l).map(([l,a])=>{const s={label:a.__meta__.label};a.__meta__.value&&(s.value=a.__meta__.value);const n=e(a.__children__);return n.length&&(s.children=n),s})}(l)}(p.value)),V=a,g=m,x=e(()=>V.selected?"Ubah Role":"Tambah Role");function j(){g("update:visible",!1),C()}const w=b({id:null,label:"",permissions:[]});function C(){Object.assign(w,{id:null,label:""})}function U(){g("save",{...w})}return f(()=>V.visible,async e=>{var l;await(async()=>{const{ok:e,data:l}=await k("permissions/options");if(e){const{permissions:e}=null==l?void 0:l.data;p.value.push(...e)}})(),e&&V.selected?(l=V.selected)&&Object.assign(w,{...l,permissions:l.permissions.map(e=>"string"==typeof e?e:e.name)}):e||C()}),i({close:j}),(e,l)=>(n(),s(r,null,[t(v,{name:"fade"},{default:u(()=>[V.visible?(n(),s("div",{key:0,class:"drawer-overlay",onClick:_(j,["self"])})):c("",!0)]),_:1}),t(v,{name:"slide"},{default:u(()=>[V.visible?(n(),s("aside",I,[o("div",N,[o("button",{type:"button",class:"btn btn-tool",onClick:j},[...l[2]||(l[2]=[o("i",{class:"fas fa-times"},null,-1)])]),o("h5",P,d(x.value),1)]),o("form",{onSubmit:_(U,["prevent"])},[o("div",R,[o("div",q,[o("div",B,[t(h,{modelValue:w.label,"onUpdate:modelValue":l[0]||(l[0]=e=>w.label=e),label:"Nama",type:"text",autofocus:"",required:""},null,8,["modelValue"])]),o("div",E,[t(F,{modelValue:w.permissions,"onUpdate:modelValue":l[1]||(l[1]=e=>w.permissions=e),permissions:y.value},null,8,["modelValue","permissions"])])])]),o("div",S,[o("button",{type:"button",class:"btn btn-secondary mr-2",onClick:j}," Batal "),o("button",z,d(a.selected?"Ubah":"Tambah"),1)])],32)])):c("",!0)]),_:1})],64))}},[["__scopeId","data-v-e4212f19"]]);export{D as default};
