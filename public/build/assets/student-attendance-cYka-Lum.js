import{a,b as e,e as s,f as t,m as l,h as n,s as c,g as i,t as d,i as r,c as o,F as u,l as v,x as p,n as m,j as g,o as f}from"./vue-DNxxE8NJ.js";import{_,g as h,a as b,b as k}from"./app-YK7FhtRg.js";import{F as y,E as x}from"./ExportButtons-CYxFzFS4.js";import w from"./SelectServerSide-Cw66L44C.js";const S={class:"content"},T={class:"container-fluid"},j={class:"row mt-3"},A={class:"col-md-12"},E={key:0,class:"row mt-4"},O={class:"col-lg-3 col-6"},V={class:"small-box bg-info"},F={class:"inner"},I={class:"col-lg-3 col-6"},C={class:"small-box bg-success"},D={class:"inner"},G={class:"col-lg-3 col-6"},K={class:"small-box bg-warning"},H={class:"inner"},L={class:"col-lg-3 col-6"},M={class:"small-box bg-danger"},z={class:"inner"},P={class:"row mt-4"},U={class:"col-12"},Y={class:"card card-outline card-navy shadow-sm"},B={class:"card-header"},N={class:"card-tools"},R={class:"card-body table-responsive p-0"},q={key:0,class:"text-center p-5"},J={key:1,class:"table table-hover ledger-table text-nowrap"},Q={class:"text-center"},W={class:"text-center"},X={class:"badge badge-success"},Z={class:"text-center"},$={class:"badge badge-warning"},aa={class:"text-center"},ea={class:"badge badge-info"},sa={class:"text-center"},ta={class:"badge badge-danger"},la={key:2,class:"text-center p-5"},na={class:"text-muted"},ca={key:0,class:"card-footer clearfix"},ia={class:"pagination pagination-sm m-0 float-right"},da=["onClick"],ra=_({__name:"student-attendance",setup(_){const ra=a(!1),oa=a([]),ua=a({total_records:0,total_students:0,present_count:0,absent_count:0,sick_count:0,permission_count:0,attendance_percentage:0}),va=a({start_date:"",end_date:"",month:"",academic_year_id:"",teacher_id:"",class_id:""}),pa=a({current_page:1,per_page:15,total:0,last_page:1}),ma=async(a=1)=>{ra.value=!0;try{const e={...va.value,page:a,per_page:pa.value.per_page};Object.keys(e).forEach(a=>{e[a]||delete e[a]});const{ok:s,data:t,error:l}=await b("reports/student-attendance",{method:"GET",params:e});s?(oa.value=t.data.attendances.data||[],pa.value={current_page:t.data.attendances.current_page,per_page:t.data.attendances.per_page,total:t.data.attendances.total,last_page:t.data.attendances.last_page}):k(l)}catch(e){k(e.message)}finally{ra.value=!1}},ga=async()=>{try{const a={...va.value};Object.keys(a).forEach(e=>{a[e]||delete a[e]});const{ok:e,data:s,error:t}=await b("reports/student-attendance/summary",{method:"GET",params:a});e&&(ua.value=s.data.summary)}catch(a){}},fa=async()=>{pa.value.current_page=1,await Promise.all([ma(1),ga()])},_a=()=>{va.value={start_date:"",end_date:"",month:"",academic_year_id:"",teacher_id:"",class_id:""},oa.value=[],ua.value={total_records:0,total_students:0,present_count:0,absent_count:0,sick_count:0,permission_count:0,attendance_percentage:0}},ha=a=>{a>=1&&a<=pa.value.last_page&&ma(a)},ba=a=>a?{present:a.filter(a=>"present"===a.status).length,sick:a.filter(a=>"sick"===a.status).length,permission:a.filter(a=>"permission"===a.status).length,absent:a.filter(a=>"absent"===a.status).length}:{present:0,sick:0,permission:0,absent:0},ka=e(()=>oa.value.length>0),ya=e(()=>Object.keys(va.value).filter(a=>va.value[a]).length>0);return s(()=>{const a=new Date,e=new Date(a.getFullYear(),a.getMonth(),1),s=new Date(a.getFullYear(),a.getMonth()+1,0);va.value.start_date=e.toISOString().split("T")[0],va.value.end_date=s.toISOString().split("T")[0],fa()}),(a,e)=>(f(),t(u,null,[e[17]||(e[17]=l('<section class="content-header" data-v-8d7fc6a0><div class="container-fluid" data-v-8d7fc6a0><div class="row" data-v-8d7fc6a0><div class="col-sm-6" data-v-8d7fc6a0><h4 class="font-serif-formal" data-v-8d7fc6a0>Laporan Absensi Siswa</h4></div><div class="col-sm-6" data-v-8d7fc6a0><ol class="breadcrumb float-sm-right" data-v-8d7fc6a0><li class="breadcrumb-item" data-v-8d7fc6a0><a href="#" data-v-8d7fc6a0>Laporan</a></li><li class="breadcrumb-item active" data-v-8d7fc6a0>Absensi Siswa</li></ol></div></div></div></section>',1)),n("section",S,[n("div",T,[c(y,{modelValue:va.value,"onUpdate:modelValue":e[0]||(e[0]=a=>va.value=a),onApply:fa,onReset:_a},null,8,["modelValue"]),n("div",j,[n("div",A,[c(w,{modelValue:va.value.class_id,"onUpdate:modelValue":e[1]||(e[1]=a=>va.value.class_id=a),label:"Filter Kelas (Opsional)",name:"class_id",placeholder:"Semua Kelas",serverside:!0,endpoint:"classrooms","label-key":"name","value-key":"id"},null,8,["modelValue"])])]),ka.value?(f(),t("div",E,[n("div",O,[n("div",V,[n("div",F,[n("h3",null,d(ua.value.total_records),1),e[4]||(e[4]=n("p",null,"Total Sesi Kelas",-1))]),e[5]||(e[5]=n("div",{class:"icon"},[n("i",{class:"fas fa-chalkboard"})],-1))])]),n("div",I,[n("div",C,[n("div",D,[n("h3",null,d(ua.value.present_count),1),e[6]||(e[6]=n("p",null,"Total Hadir",-1))]),e[7]||(e[7]=n("div",{class:"icon"},[n("i",{class:"fas fa-user-check"})],-1))])]),n("div",G,[n("div",K,[n("div",H,[n("h3",null,d(ua.value.sick_count+ua.value.permission_count),1),e[8]||(e[8]=n("p",null,"Sakit / Izin",-1))]),e[9]||(e[9]=n("div",{class:"icon"},[n("i",{class:"fas fa-notes-medical"})],-1))])]),n("div",L,[n("div",M,[n("div",z,[n("h3",null,d(ua.value.absent_count),1),e[10]||(e[10]=n("p",null,"Tidak Hadir (Alpha)",-1))]),e[11]||(e[11]=n("div",{class:"icon"},[n("i",{class:"fas fa-user-times"})],-1))])])])):i("",!0),n("div",P,[n("div",U,[n("div",Y,[n("div",B,[e[12]||(e[12]=n("h3",{class:"card-title font-serif-formal"},[n("i",{class:"fas fa-table mr-2"}),r(" Data Absensi Siswa ")],-1)),n("div",N,[ka.value?(f(),o(x,{key:0,filters:va.value,"report-type":"student-attendance"},null,8,["filters"])):i("",!0)])]),n("div",R,[ra.value?(f(),t("div",q,[...e[13]||(e[13]=[n("i",{class:"fas fa-spinner fa-spin fa-3x text-navy"},null,-1),n("p",{class:"mt-3"},"Memuat data...",-1)])])):ka.value?(f(),t("table",J,[e[15]||(e[15]=n("thead",null,[n("tr",null,[n("th",{style:{width:"5%"}},"No"),n("th",null,"Tanggal"),n("th",null,"Kelas"),n("th",null,"Guru Pengajar"),n("th",{class:"text-center"},"Hadir"),n("th",{class:"text-center"},"Sakit"),n("th",{class:"text-center"},"Izin"),n("th",{class:"text-center"},"Alpha")])],-1)),n("tbody",null,[(f(!0),t(u,null,v(oa.value,(a,s)=>{var l,c;return f(),t("tr",{key:a.id},[n("td",Q,d((pa.value.current_page-1)*pa.value.per_page+s+1),1),n("td",null,[e[14]||(e[14]=n("i",{class:"fas fa-calendar-day mr-1 text-muted"},null,-1)),r(" "+d(p(h)(a.date)),1)]),n("td",null,[n("strong",null,d((null==(l=a.classroom)?void 0:l.name)||"-"),1)]),n("td",null,d((null==(c=a.teacher)?void 0:c.name)||"-"),1),n("td",W,[n("span",X,d(ba(a.details).present),1)]),n("td",Z,[n("span",$,d(ba(a.details).sick),1)]),n("td",aa,[n("span",ea,d(ba(a.details).permission),1)]),n("td",sa,[n("span",ta,d(ba(a.details).absent),1)])])}),128))])])):(f(),t("div",la,[e[16]||(e[16]=n("i",{class:"fas fa-inbox fa-3x text-muted mb-3"},null,-1)),n("p",na,d(ya.value?"Tidak ada data untuk filter yang dipilih":'Silakan pilih filter dan klik "Tampilkan Laporan"'),1)]))]),ka.value&&pa.value.last_page>1?(f(),t("div",ca,[n("ul",ia,[n("li",{class:m(["page-item",{disabled:1===pa.value.current_page}])},[n("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=g(a=>ha(pa.value.current_page-1),["prevent"]))},"«")],2),(f(!0),t(u,null,v(pa.value.last_page,a=>(f(),t("li",{key:a,class:m(["page-item",{active:pa.value.current_page===a}])},[n("a",{class:"page-link",href:"#",onClick:g(e=>ha(a),["prevent"])},d(a),9,da)],2))),128)),n("li",{class:m(["page-item",{disabled:pa.value.current_page===pa.value.last_page}])},[n("a",{class:"page-link",href:"#",onClick:e[3]||(e[3]=g(a=>ha(pa.value.current_page+1),["prevent"]))},"»")],2)])])):i("",!0)])])])])])],64))}},[["__scopeId","data-v-8d7fc6a0"]]);export{ra as default};
