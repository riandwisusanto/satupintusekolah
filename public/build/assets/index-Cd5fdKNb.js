import{_ as a,u as e,g as t,h as s,a as l,b as n,d as c}from"./app-dRKbozfU.js";import"./dayjs.min-ViwXrfnO.js";import{a as r,e as i,K as o,f as u,o as d,g as v,h as m,t as h,i as k,b as p,m as b,s as f,n as g,x as y,F as w}from"./vue-3FdbM0aa.js";const _={class:"camera-capture"},C={key:0,class:"camera-container"},S={key:0,class:"camera-loading"},A={key:1,class:"camera-error"},T={key:1,class:"captured-container"},I=["src"],D={key:2,class:"capture-controls"},O=a({__name:"CameraCapture",emits:["capture"],setup(a,{emit:e}){const t=e,s=r(null),l=r(!1),n=r(""),c=r(""),p=r(null),b=async()=>{l.value=!0,n.value="";const a=navigator.mediaDevices?navigator.mediaDevices.getUserMedia?"localhost"===location.hostname||"127.0.0.1"===location.hostname||location.hostname.endsWith(".test")||location.hostname.includes("satupintusekolah.test")||"https:"===location.protocol?{supported:!0}:{supported:!1,message:"Akses kamera membutuhkan koneksi HTTPS. Untuk development lokal, gunakan localhost, HTTPS, atau Valet domain (.test)."}:{supported:!1,message:"Browser tidak mendukung MediaDevices API. Silakan update browser ke versi terbaru."}:{supported:!1,message:"Browser tidak mendukung akses kamera. Silakan gunakan Chrome, Firefox, atau Edge versi terbaru."};if(!a.supported)return n.value=a.message,void(l.value=!1);try{const a={video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},audio:!1};p.value=await navigator.mediaDevices.getUserMedia(a),s.value&&(s.value.srcObject=p.value)}catch(e){n.value=O(e)}finally{l.value=!1}},f=()=>{if(!s.value||!p.value)return;const a=document.createElement("canvas"),e=a.getContext("2d");a.width=s.value.videoWidth,a.height=s.value.videoHeight,e.drawImage(s.value,0,0),a.toBlob(a=>{const e=new FileReader;e.onload=()=>{c.value=e.result,g()},e.readAsDataURL(a)},"image/jpeg",.8)},g=()=>{p.value&&(p.value.getTracks().forEach(a=>a.stop()),p.value=null),s.value&&(s.value.srcObject=null)},y=()=>{c.value="",b()},w=()=>{c.value&&t("capture",c.value)},O=a=>{switch(a.name){case"NotAllowedError":return"Akses kamera ditolak. Silakan izinkan akses kamera di browser Anda.";case"NotFoundError":return"Tidak ada kamera yang ditemukan di perangkat ini.";case"NotSupportedError":return"Browser tidak mendukung akses kamera.";case"NotReadableError":return"Kamera sedang digunakan oleh aplikasi lain.";default:return"Terjadi kesalahan saat mengakses kamera: "+a.message}};return i(()=>{b()}),o(()=>{g()}),(a,e)=>(d(),u("div",_,[c.value?(d(),u("div",T,[m("img",{src:c.value,alt:"Captured",class:"captured-image"},null,8,I),m("div",{class:"captured-actions"},[m("button",{onClick:y,class:"btn btn-secondary"},[...e[3]||(e[3]=[m("i",{class:"fas fa-redo"},null,-1),k(" Ulang ",-1)])]),m("button",{onClick:w,class:"btn btn-primary"},[...e[4]||(e[4]=[m("i",{class:"fas fa-check"},null,-1),k(" Gunakan ",-1)])])])])):(d(),u("div",C,[m("video",{ref_key:"videoElement",ref:s,autoplay:"",playsinline:"",muted:"",class:"camera-preview"},null,512),l.value?(d(),u("div",S,[...e[0]||(e[0]=[m("div",{class:"spinner-border text-primary",role:"status"},[m("span",{class:"sr-only"},"Loading...")],-1),m("p",null,"Mengakses kamera...",-1)])])):v("",!0),n.value?(d(),u("div",A,[e[2]||(e[2]=m("i",{class:"fas fa-exclamation-triangle"},null,-1)),m("p",null,h(n.value),1),m("button",{onClick:b,class:"btn btn-sm btn-primary"},[...e[1]||(e[1]=[m("i",{class:"fas fa-redo"},null,-1),k(" Coba Lagi ",-1)])])])):v("",!0)])),l.value||n.value||c.value?v("",!0):(d(),u("div",D,[m("button",{onClick:f,class:"btn btn-lg btn-primary capture-btn"},[...e[5]||(e[5]=[m("i",{class:"fas fa-camera"},null,-1),m("span",null,"Ambil Foto",-1)])])]))]))}},[["__scopeId","data-v-55860e72"]]),j={class:"content"},x={class:"container-fluid"},F={key:0,class:"text-center"},E={key:1,class:"camera-modal"},M={class:"camera-modal-content"},B={class:"camera-modal-header"},H={class:"font-serif-formal"},U={class:"camera-modal-body"},L={key:2,class:"row"},P={class:"col-md-6"},N={class:"card card-outline card-navy shadow-sm"},G={class:"card-body text-center"},R={class:"attendance-status"},$={class:"font-serif-formal"},K={key:0,class:"text-muted"},W={class:"mt-3"},z={key:0,class:"col-md-6"},V={class:"card card-outline card-navy shadow-sm"},q={class:"card-body"},J={class:"table table-sm ledger-table"},Q=["innerHTML"],X={key:0,class:"mt-3"},Y={class:"photo-preview"},Z=["src"],aa=["src"],ea=a({__name:"index",setup(a){const{user:o}=e(),_=r(!1),C=r(null);r([]);const S=r(!1),A=r("check-in"),T=r(""),I=p(()=>!C.value||"check_out"===C.value.status),D=p(()=>C.value&&"check_in"===C.value.status),ea=p(()=>{if(!C.value)return"Belum Absen";switch(C.value.status){case"check_in":return"Sudah Check-In";case"check_out":return"Sudah Check-Out";default:return C.value.status}}),ta=async()=>{var a;_.value=!0;try{const{ok:e,data:t,error:s}=await l("teacher-attendances/today/"+o.user.id);C.value=e&&(null==(a=t.data)?void 0:a.attendances[0])||null}catch(e){n(e.message)}finally{_.value=!1}},sa=a=>{A.value=a,T.value="",S.value=!0},la=async a=>{T.value=a,S.value=!1,"check-in"===A.value?await na(a):await ca(a)},na=async a=>{_.value=!0;try{const e=new FormData;e.append("teacher_id",o.user.id),e.append("date",(new Date).toISOString().split("T")[0]),e.append("time_in",s((new Date).toISOString().split("T")[1].split(".")[0])),e.append("photo_in",ra(a,"check-in.jpg")),e.append("status","check_in");const{ok:t,data:r,error:i}=await l("teacher-attendances/check-in",{method:"POST",body:e,headers:{"Content-Type":"multipart/form-data"}});t?(c("Check-in berhasil!"),await ta()):(n(i),S.value=!0)}catch(e){n(e.message),S.value=!0}finally{_.value=!1}},ca=async a=>{if(C.value){_.value=!0;try{const e=new FormData;e.append("photo_out",ra(a,"check-out.jpg")),e.append("time_out",s((new Date).toISOString().split("T")[1].split(".")[0]));const{ok:t,data:r,error:i}=await l(`teacher-attendances/${C.value.id}/check-out`,{method:"POST",body:e,headers:{"Content-Type":"multipart/form-data"}});t?(c("Check-out berhasil!"),await ta()):(n(i),S.value=!0)}catch(e){n(e.message),S.value=!0}finally{_.value=!1}}else n("Anda belum melakukan check-in")},ra=(a,e)=>{const t=a.split(","),s=t[0].match(/:(.*?);/)[1],l=atob(t[1]);let n=l.length;const c=new Uint8Array(n);for(;n--;)c[n]=l.charCodeAt(n);return new File([c],e,{type:s})},ia=()=>{if(!C.value)return"fas fa-clock not-yet";switch(C.value.status){case"check_in":return"fas fa-sign-in-alt check-in";case"check_out":return"fas fa-sign-out-alt check-out";default:return"fas fa-clock not-yet"}};return i(()=>{ta()}),(a,e)=>(d(),u(w,null,[e[13]||(e[13]=b('<section class="content-header" data-v-11bb0f87><div class="container-fluid" data-v-11bb0f87><div class="row" data-v-11bb0f87><div class="col-sm-6" data-v-11bb0f87><h4 class="font-serif-formal" data-v-11bb0f87>Absensi Guru</h4></div><div class="col-sm-6" data-v-11bb0f87><ol class="breadcrumb float-sm-right" data-v-11bb0f87><li class="breadcrumb-item" data-v-11bb0f87><a href="#" data-v-11bb0f87>Absensi</a></li><li class="breadcrumb-item active" data-v-11bb0f87>Absensi Guru</li></ol></div></div></div></section>',1)),m("section",j,[m("div",x,[_.value&&!S.value?(d(),u("div",F,[...e[3]||(e[3]=[m("i",{class:"fas fa-spinner fa-spin"},null,-1),k(" Memuat data... ",-1)])])):v("",!0),S.value?(d(),u("div",E,[m("div",M,[m("div",B,[m("h5",H,h("check-in"===A.value?"Check-In":"Check-Out"),1),m("button",{onClick:e[0]||(e[0]=a=>S.value=!1),class:"btn btn-tool"},[...e[4]||(e[4]=[m("i",{class:"fas fa-times"},null,-1)])])]),m("div",U,[f(O,{onCapture:la})])])])):v("",!0),S.value?v("",!0):(d(),u("div",L,[m("div",P,[m("div",N,[e[7]||(e[7]=m("div",{class:"card-header border-bottom-0"},[m("h3",{class:"card-title font-serif-formal"},[m("i",{class:"fas fa-user-clock mr-1"}),k(" Status Absensi Hari Ini ")])],-1)),m("div",G,[m("div",R,[m("i",{class:g([ia(),"status-icon"])},null,2),m("h4",$,h(ea.value),1),C.value?(d(),u("p",K,h(y(t)(C.value.date)),1)):v("",!0)]),m("div",W,[I.value?(d(),u("button",{key:0,onClick:e[1]||(e[1]=a=>sa("check-in")),class:"btn btn-navy btn-lg shadow-sm"},[...e[5]||(e[5]=[m("i",{class:"fas fa-sign-in-alt mr-1"},null,-1),k(" Check-In ",-1)])])):v("",!0),D.value?(d(),u("button",{key:1,onClick:e[2]||(e[2]=a=>sa("check-out")),class:"btn btn-danger btn-lg shadow-sm"},[...e[6]||(e[6]=[m("i",{class:"fas fa-sign-out-alt mr-1"},null,-1),k(" Check-Out ",-1)])])):v("",!0)])])])]),C.value?(d(),u("div",z,[m("div",V,[e[12]||(e[12]=m("div",{class:"card-header border-bottom-0"},[m("h3",{class:"card-title font-serif-formal"},[m("i",{class:"fas fa-info-circle mr-1"}),k(" Detail Absensi ")])],-1)),m("div",q,[m("table",J,[m("tr",null,[e[8]||(e[8]=m("th",null,"Check-In:",-1)),m("td",null,h(y(s)(C.value.time_in)),1)]),m("tr",null,[e[9]||(e[9]=m("th",null,"Check-Out:",-1)),m("td",null,h(y(s)(C.value.time_out)),1)]),m("tr",null,[e[10]||(e[10]=m("th",null,"Status:",-1)),m("td",{innerHTML:C.value.status},null,8,Q)])]),C.value.photo_in||C.value.photo_out?(d(),u("div",X,[e[11]||(e[11]=m("h6",{class:"font-serif-formal"},"Foto Absensi:",-1)),m("div",Y,[C.value.photo_in?(d(),u("img",{key:0,src:`/storage/${C.value.photo_in}`,alt:"Check-in",class:"attendance-photo shadow-sm"},null,8,Z)):v("",!0),C.value.photo_out?(d(),u("img",{key:1,src:`/storage/${C.value.photo_out}`,alt:"Check-out",class:"attendance-photo shadow-sm"},null,8,aa)):v("",!0)])])):v("",!0)])])])):v("",!0)]))])])],64))}},[["__scopeId","data-v-11bb0f87"]]);export{ea as default};
