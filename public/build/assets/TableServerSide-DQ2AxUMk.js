import{a as e,b as a,w as l,e as t,P as s,f as o,g as n,h as u,J as i,c as r,t as c,q as d,i as v,k as p,v as f,F as m,l as y,y as b,n as h,r as k,o as w,N as g,Q as x}from"./vue-3FdbM0aa.js";import{_ as B,u as C}from"./app-DGJl0Mcl.js";const S={class:"card card-outline card-navy position-relative shadow-sm"},j={key:0,class:"overlay d-flex justify-content-center align-items-center"},_={class:"card-header p-2 d-flex justify-content-between align-items-center flex-wrap border-bottom-0"},A={class:"d-flex align-items-center mb-2 mb-md-0 gap-2"},$={class:"font-serif-formal mb-0"},T=["disabled"],E={key:0,class:"input-group ms-auto",style:{width:"180px"}},M={class:"card-body table-responsive p-0"},D={class:"table table-hover ledger-table text-nowrap mb-0"},R=["onClick"],K={key:1},L={key:0},N=["onClick"],O={key:1},U={key:0},q=["colspan"],P={key:1,class:"card-footer clearfix"},V={class:"row"},W={class:"col-md-1 col-sm-1 col-4"},z=["value"],F={class:"col-md-5 col-sm-5 col-8"},I={class:"float-right float-sm-left"},J={class:"col-md-6 col-sm-6 col-12"},Q={class:"d-flex justify-content-end w-100 w-md-auto"},G={class:"pagination pagination-sm mb-0"},H=["onClick"],X=B({__name:"TableServerSide",props:{title:{type:String,default:"Table"},serverside:{type:Boolean,default:!0},showAddButton:{type:Boolean,default:!1},addRoute:{type:String,default:""},showDrawer:{type:Boolean,default:!1},showExportButton:{type:Boolean,default:!1},loadingExport:{type:Boolean,default:!1},columns:{type:Array,required:!0},initialSort:{type:Object,default:()=>({field:null,order:"asc"})},endpoint:{type:String,default:""},per_page:{type:Number,default:10},extra:{type:Object,default:()=>({})},idKey:{type:String,default:"id"},rows:{type:Array,default:()=>[]}},emits:["row-click","export","initial-load","open-drawer"],setup(B,{expose:X,emit:Y}){const Z=B,ee=Y,ae=e=>e&&("object"==typeof e||"function"==typeof e),le=(e,a)=>a.split(".").reduce((e,a)=>null==e?void 0:e[a],e),te=e(""),se=e(1),oe=e(Z.per_page),ne=e(Z.initialSort.field),ue=e(Z.initialSort.order),ie=e([]),re=e(!1),ce=e(0),de=a(()=>Z.serverside?ce.value:Z.rows.length),ve=a(()=>"all"===oe.value?de.value||1:Number(oe.value)),pe=a(()=>Math.max(1,Math.ceil(de.value/ve.value))),fe=a(()=>0===de.value?0:(se.value-1)*ve.value+1),me=a(()=>Math.min(fe.value+ve.value-1,de.value)),ye=a(()=>{const e=[],a=Math.max(1,se.value-2),l=Math.min(pe.value,a+4);for(let t=a;t<=l;t++)e.push(t);return e}),be=a(()=>{if(Z.serverside)return ie.value;let e=[...Z.rows];if(te.value){const a=te.value.toLowerCase();e=e.filter(e=>Object.values(e).some(e=>String(e).toLowerCase().includes(a)))}return ne.value&&e.sort((e,a)=>{const l=le(e,ne.value),t=le(a,ne.value);return l<t?"asc"===ue.value?-1:1:l>t?"asc"===ue.value?1:-1:0}),"all"===oe.value?e:e.slice(fe.value-1,fe.value-1+ve.value)}),he=C().user.accesstoken||"";async function ke(){if(!Z.serverside)return;re.value=!0;const e=new URLSearchParams({page:se.value,per_page:oe.value,search:te.value,sort:("asc"===ue.value?"":"-")+ne.value,...Z.extra});"all"===oe.value&&(e.delete("per_page"),e.append("all","true"));try{const a=await fetch(`http://satupintusekolah.test/api/v1/${Z.endpoint}?${e}`,{headers:{Accept:"application/json",Authorization:`Bearer ${he}`}}),l=await a.json();ie.value=l.data,ce.value=l.meta.total||0}catch(a){ie.value=[],ce.value=0}re.value=!1}function we(){se.value=1,Z.serverside&&ke()}function ge(e){e<1||e>pe.value||(se.value=e,Z.serverside&&ke())}function xe(e){ee("export",e)}function Be(){ee("open-drawer",!0)}let Ce;return l(te,()=>{clearTimeout(Ce),Ce=setTimeout(()=>we(),400)}),l(oe,we),l(()=>Z.endpoint,we),l(()=>Z.extra,we,{deep:!0}),t(async()=>{Z.serverside?ee("initial-load",ke):ke()}),t(()=>ke()),s(()=>clearTimeout(Ce)),X({reload:we}),(e,a)=>{const l=k("router-link");return w(),o("div",S,[re.value?(w(),o("div",j,[...a[4]||(a[4]=[u("i",{class:"fas fa-2x fa-sync-alt fa-spin"},null,-1)])])):n("",!0),u("div",_,[u("div",A,[u("h5",$,c(Z.title),1),Z.showAddButton&&Z.addRoute?(w(),r(l,{key:0,to:Z.addRoute,class:"btn btn-navy btn-sm me-2 shadow-sm"},{default:d(()=>[...a[5]||(a[5]=[u("i",{class:"fas fa-plus me-1"},null,-1),v(" Tambah Baru ",-1)])]),_:1},8,["to"])):n("",!0),Z.showAddButton&&Z.showDrawer?(w(),o("button",{key:1,class:"btn btn-navy btn-sm me-2 shadow-sm",onClick:Be},[...a[6]||(a[6]=[u("i",{class:"fas fa-plus me-1"},null,-1),v(" Tambah Baru ",-1)])])):n("",!0),Z.showExportButton?(w(),o("button",{key:2,class:"btn btn-success btn-sm shadow-sm",onClick:xe,disabled:B.loadingExport},[...a[7]||(a[7]=[u("i",{class:"fas fa-file-export mr-1"},null,-1),v(" Export Data ",-1)])],8,T)):n("",!0)]),Z.serverside?(w(),o("div",E,[p(u("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>te.value=e),type:"text",class:"form-control float-right",placeholder:"Search"},null,512),[[f,te.value]]),u("div",{class:"input-group-append"},[u("button",{class:"btn btn-default",onClick:we},[...a[8]||(a[8]=[u("i",{class:"fas fa-search"},null,-1)])])])])):n("",!0)]),u("div",M,[u("table",D,[u("thead",null,[u("tr",null,[(w(!0),o(m,null,y(B.columns,(a,l)=>(w(),o("th",{key:l,onClick:e=>{return!1!==a.sortable&&(l=a.field,ne.value===l?ue.value="asc"===ue.value?"desc":"asc":(ne.value=l,ue.value="asc"),void(Z.serverside&&ke()));var l},style:g({cursor:!1===a.sortable?"default":"pointer",minWidth:a.minWidth??""})},[i(e.$slots,`header-${a.field}`,{col:a},()=>[ae(a.display)?(w(),r(x(a.display),{key:0})):(w(),o("span",K,c(a.display),1))],!0),ne.value===a.field&&!1!==a.sortable?(w(),o("span",L,c("asc"===ue.value?"▲":"▼"),1)):n("",!0)],12,R))),128))])]),u("tbody",null,[(w(!0),o(m,null,y(be.value,(a,l)=>(w(),o("tr",{key:a[B.idKey],onClick:e=>function(e,a){ee("row-click",e,a)}(a,l),style:{cursor:"pointer"}},[(w(!0),o(m,null,y(B.columns,t=>(w(),o("td",{key:t.field},[i(e.$slots,`cell-${t.field}`,{row:a,col:t,index:l},()=>[ae(t.component)?(w(),r(x(t.component),{key:0,row:a,index:l,value:le(a,t.field)},null,8,["row","index","value"])):(w(),o("span",O,c(le(a,t.field)),1))],!0)]))),128))],8,N))),128)),0===be.value.length?(w(),o("tr",U,[u("td",{colspan:B.columns.length,class:"text-center"},"Data Kosong",8,q)])):n("",!0)])])]),Z.serverside?(w(),o("div",P,[u("div",V,[u("div",W,[p(u("select",{class:"form-control form-control-sm","onUpdate:modelValue":a[1]||(a[1]=e=>oe.value=e)},[a[9]||(a[9]=u("option",{value:"all"},"All",-1)),(w(),o(m,null,y([2,10,15,50,100,200],e=>u("option",{key:e,value:e},c(e),9,z)),64))],512),[[b,oe.value]])]),u("div",F,[u("p",I,c(fe.value)+" - "+c(me.value)+" dari "+c(de.value)+" data",1)]),u("div",J,[u("div",Q,[u("ul",G,[u("li",{class:h(["page-item",{disabled:1===se.value}])},[u("button",{class:"page-link",onClick:a[2]||(a[2]=e=>ge(se.value-1))},"«")],2),(w(!0),o(m,null,y(ye.value,e=>(w(),o("li",{class:h(["page-item",{active:se.value===e}]),key:e},[u("button",{class:"page-link",onClick:a=>ge(e)},c(e),9,H)],2))),128)),u("li",{class:h(["page-item",{disabled:se.value===pe.value}])},[u("button",{class:"page-link",onClick:a[3]||(a[3]=e=>ge(se.value+1))},"»")],2)])])])])])):n("",!0),i(e.$slots,"footer",{},void 0,!0)])}}},[["__scopeId","data-v-1cf592ec"]]);export{X as default};
