import{_ as a,u as t,h as l,i as s,j as e,a as i}from"./app-Bhqy4hvs.js";import{a as o,b as n,l as c,f as d,y as r,m as u,g as b,t as v,n as h,i as p,F as m,s as f,u as y,h as k,j as _,r as g,o as C}from"./vue-CzxLGHcz.js";const w={class:"content"},$={class:"container-fluid"},Y={class:"row mb-4"},I={class:"col-lg-4 col-6"},T={class:"small-box bg-info"},x={class:"inner"},F={class:"col-lg-4 col-6"},M={class:"small-box bg-success"},O={class:"inner"},D={class:"col-lg-4 col-6"},S={class:"small-box bg-primary"},j={class:"inner"},H={class:"row mb-3"},A={class:"col-12"},L={class:"btn-group",role:"group"},z={key:0,class:"text-center"},B={key:1,class:"card"},G={class:"card-body p-0"},V={key:0,class:"alert alert-info m-3"},K={key:1,class:"table-responsive"},P={class:"table table-hover"},R={class:"thead-light"},q={key:0},E={class:"badge badge-secondary"},J={key:0},N={class:"btn-group btn-group-sm"},Q=["onClick"],U=["onClick"],W={key:0,class:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)","z-index":"9999"}},X={class:"modal-dialog modal-lg"},Z={class:"modal-content"},aa={class:"modal-body"},ta=["src"],la={key:1},sa=["src"],ea={key:1},ia={key:1,class:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.8)","z-index":"9999"}},oa={class:"modal-dialog modal-md"},na={class:"modal-content"},ca={class:"modal-header"},da={class:"modal-title"},ra={class:"modal-body text-center"},ua={class:"photo-container"},ba=["src","alt"],va={class:"photo-info mt-3"},ha=a({__name:"history",setup(a){const ha=o(),pa=o(!1),ma=o([]),fa=o(!1),ya=o("recent"),{user:ka}=t(),_a=n(()=>1===ka.user.role_id),ga=o({total_days:0,absent_days:0,attendance_rate:0}),Ca=n(()=>ma.value.slice(0,7)),wa=[{field:"date",display:"Tanggal",sortable:!1},..._a.value?[{field:"teacher.name",display:"Guru",sortable:!1}]:[],{field:"time_in",display:"In",sortable:!1},{field:"time_out",display:"Out",sortable:!1},{field:"photo_in",display:"Foto In",sortable:!1},{field:"photo_out",display:"Foto Out",sortable:!1}],$a=(a,t)=>{if(!a||!t)return"-";const l=e(`${e().format("YYYY-MM-DD")}T${a}`),s=e(`${e().format("YYYY-MM-DD")}T${t}`);if(!l.isValid()||!s.isValid())return"-";const i=s.diff(l,"minute");return`${Math.floor(i/60)}j ${i%60}m`},Ya=()=>{pa.value=!0},Ia=()=>{pa.value=!1},Ta=o(!1),xa=o({url:"",type:"",date:""}),Fa=a=>{xa.value={url:`/storage/${a.photo}`,type:a.type,date:a.date||(new Date).toISOString()},Ta.value=!0},Ma=()=>{Ta.value=!1,xa.value={url:"",type:"",date:""}},Oa=()=>{(async()=>{try{const{ok:a,data:t}=await i(`teacher-attendances/monthly-report?month=${e().format("YYYY-MM")}${_a.value?"":`&teacher_id=${ka.user.id}`}`);if(a){const{statistics:a}=t.data;ga.value={total_days:a.total_days,absent_days:a.absent_days,attendance_rate:a.total_days>0?(a.total_days-a.absent_days)/a.total_days*100:0}}}catch(a){}})(),(async()=>{fa.value=!0;try{const{ok:a,data:t}=await i(`teacher-attendances/history/${ka.user.id}?per_page=7&sort_field=date&sort_order=desc`);a&&t.data&&(ma.value=t.data)}catch(a){}finally{fa.value=!1}})()},Da=a=>{switch(a){case"check_in":case"check_out":return"Hadir";case"sick":return"Sakit";case"permission":return"Izin";default:return"Cuti"}};return c(()=>{Oa()}),(a,t)=>{const e=g("TableServerSide");return C(),d(m,null,[t[25]||(t[25]=r('<section class="content-header" data-v-d9c7fb8b><div class="container-fluid" data-v-d9c7fb8b><div class="row" data-v-d9c7fb8b><div class="col-sm-6" data-v-d9c7fb8b><h4 data-v-d9c7fb8b>History Absensi</h4></div><div class="col-sm-6" data-v-d9c7fb8b><ol class="breadcrumb float-sm-right" data-v-d9c7fb8b><li class="breadcrumb-item" data-v-d9c7fb8b><a href="#" data-v-d9c7fb8b>Absensi</a></li><li class="breadcrumb-item active" data-v-d9c7fb8b>History</li></ol></div></div></div></section>',1)),u("section",w,[u("div",$,[u("div",Y,[u("div",I,[u("div",T,[u("div",x,[u("h3",null,v(ga.value.total_days),1),t[0]||(t[0]=u("p",null,"Hadir Bulan Ini",-1))]),t[1]||(t[1]=u("div",{class:"icon"},[u("i",{class:"fas fa-calendar-check"})],-1))])]),u("div",F,[u("div",M,[u("div",O,[u("h3",null,v(ga.value.absent_days||0),1),t[2]||(t[2]=u("p",null,"Tidak Hadir",-1))]),t[3]||(t[3]=u("div",{class:"icon"},[u("i",{class:"fas fa-user-times"})],-1))])]),u("div",D,[u("div",S,[u("div",j,[u("h3",null,v(ga.value.attendance_rate.toFixed(2)||0)+"%",1),t[4]||(t[4]=u("p",null,"Tingkat Kehadiran",-1))]),t[5]||(t[5]=u("div",{class:"icon"},[u("i",{class:"fas fa-percentage"})],-1))])])]),u("div",H,[u("div",A,[u("div",L,[u("button",{onClick:Oa,class:h(["btn btn-default",{"btn-primary":"recent"===ya.value}])},[...t[6]||(t[6]=[u("i",{class:"fas fa-history"},null,-1),p(" Terkini ",-1)])],2),u("button",{onClick:Ya,class:"btn btn-default"},[...t[7]||(t[7]=[u("i",{class:"fas fa-list"},null,-1),p(" Lihat Semua ",-1)])])])])]),fa.value?(C(),d("div",z,[...t[8]||(t[8]=[u("i",{class:"fas fa-spinner fa-spin"},null,-1),p(" Memuat data... ",-1)])])):(C(),d("div",B,[t[18]||(t[18]=u("div",{class:"card-header"},[u("h3",{class:"card-title"},[u("i",{class:"fas fa-clock"}),p(" Aktivitas Terkini (7 hari terakhir) ")])],-1)),u("div",G,[0===Ca.value.length?(C(),d("div",V,[...t[9]||(t[9]=[u("i",{class:"fas fa-info-circle"},null,-1),p(" Belum ada data absensi untuk 7 hari terakhir. ",-1)])])):(C(),d("div",K,[u("table",P,[u("thead",R,[u("tr",null,[t[10]||(t[10]=u("th",null,"Tanggal",-1)),_a.value?(C(),d("th",q,"Guru")):b("",!0),t[11]||(t[11]=u("th",null,"In",-1)),t[12]||(t[12]=u("th",null,"Out",-1)),t[13]||(t[13]=u("th",null,"Durasi",-1)),t[14]||(t[14]=u("th",null,"Status",-1)),t[15]||(t[15]=u("th",null,"Foto",-1))])]),u("tbody",null,[(C(!0),d(m,null,f(Ca.value,a=>{var e;return C(),d("tr",{key:a.id},[u("td",null,[u("span",E,v(y(l)(a.date)),1)]),_a.value?(C(),d("td",J,v(null==(e=a.teacher)?void 0:e.name),1)):b("",!0),u("td",null,v(y(s)(a.time_in)),1),u("td",null,v(y(s)(a.time_out)),1),u("td",null,v(a.work_duration||$a(a.time_in,a.time_out)),1),u("td",null,v(Da(a.status)),1),u("td",null,[u("div",N,[a.photo_in?(C(),d("button",{key:0,onClick:t=>Fa({photo:a.photo_in,type:"in",date:a.date}),class:"btn btn-info btn-sm",title:"Lihat Foto Check-In"},[...t[16]||(t[16]=[u("i",{class:"fas fa-camera"},null,-1)])],8,Q)):b("",!0),a.photo_out?(C(),d("button",{key:1,onClick:t=>Fa({photo:a.photo_out,type:"out",date:a.date}),class:"btn btn-warning btn-sm",title:"Lihat Foto Check-Out"},[...t[17]||(t[17]=[u("i",{class:"fas fa-camera"},null,-1)])],8,U)):b("",!0)])])])}),128))])])]))])]))])]),pa.value?(C(),d("div",W,[u("div",X,[u("div",Z,[u("div",{class:"modal-header"},[t[20]||(t[20]=u("h4",{class:"modal-title"}," Detail Absensi Lengkap ",-1)),u("button",{type:"button",onClick:Ia,class:"close"},[...t[19]||(t[19]=[u("span",null,"×",-1)])])]),u("div",aa,[k(e,{ref_key:"tableRef",ref:ha,title:"",columns:wa,endpoint:`teacher-attendances/history/${y(ka).user.id}`,"initial-sort":{field:"date",order:"desc"},per_page:10},{"cell-date":_(({row:a})=>[p(v(y(l)(a.date)),1)]),"cell-time_in":_(({row:a})=>[p(v(y(s)(a.time_in)),1)]),"cell-time_out":_(({row:a})=>[p(v(y(s)(a.time_out)),1)]),"cell-photo_in":_(({row:a})=>[a.photo_in?(C(),d("img",{key:0,src:`/storage/${a.photo_in}`,class:"mini-photo"},null,8,ta)):(C(),d("span",la,"-"))]),"cell-photo_out":_(({row:a})=>[a.photo_out?(C(),d("img",{key:0,src:`/storage/${a.photo_out}`,class:"mini-photo"},null,8,sa)):(C(),d("span",ea,"-"))]),_:1},8,["endpoint"])])])])])):b("",!0),Ta.value?(C(),d("div",ia,[u("div",oa,[u("div",na,[u("div",ca,[u("h4",da,[t[21]||(t[21]=u("i",{class:"fas fa-camera"},null,-1)),p(" "+v("in"===xa.value.type?"Foto Check-In":"Foto Check-Out"),1)]),u("button",{type:"button",onClick:Ma,class:"close"},[...t[22]||(t[22]=[u("span",null,"×",-1)])])]),u("div",ra,[u("div",ua,[u("img",{src:xa.value.url,alt:("in"===xa.value.type?"Check-In":"Check-Out")+" Photo",class:"attendance-photo-large"},null,8,ba)]),u("div",va,[u("p",null,[t[23]||(t[23]=u("strong",null,"Tipe:",-1)),p(" "+v("in"===xa.value.type?"Check-In":"Check-Out"),1)]),u("p",null,[t[24]||(t[24]=u("strong",null,"Tanggal:",-1)),p(" "+v(y(l)(xa.value.date)),1)])])])])])])):b("",!0)],64)}}},[["__scopeId","data-v-d9c7fb8b"]]);export{ha as default};
