import{a,b as e,l as s,f as t,y as l,m as n,h as c,g as i,t as r,i as d,c as o,F as u,s as v,u as p,n as g,p as m,o as _}from"./vue-CzxLGHcz.js";import{_ as b,h as f,a as h,b as k}from"./app-Bqfx2xBk.js";import{F as y,E as x}from"./ExportButtons-DZ6HkTwL.js";const w={class:"content"},S={class:"container-fluid"},T={key:0,class:"row mt-4"},j={class:"col-lg-3 col-6"},E={class:"small-box bg-info"},A={class:"inner"},I={class:"col-lg-3 col-6"},O={class:"small-box bg-success"},C={class:"inner"},D={class:"col-lg-3 col-6"},G={class:"small-box bg-warning"},H={class:"inner"},K={class:"col-lg-3 col-6"},L={class:"small-box bg-danger"},V={class:"inner"},z={class:"row mt-4"},F={class:"col-12"},P={class:"card card-outline card-navy shadow-sm"},B={class:"card-header"},M={class:"card-tools"},N={class:"card-body table-responsive p-0"},R={key:0,class:"text-center p-5"},U={key:1,class:"table table-hover ledger-table text-nowrap"},q={class:"text-center"},J={class:"text-center"},Q={class:"badge badge-success"},W={class:"text-center"},X={class:"badge badge-warning"},Y={class:"text-center"},Z={class:"badge badge-info"},$={class:"text-center"},aa={class:"badge badge-danger"},ea={key:2,class:"text-center p-5"},sa={class:"text-muted"},ta={key:0,class:"card-footer clearfix"},la={class:"pagination pagination-sm m-0 float-right"},na=["onClick"],ca=b({__name:"student-attendance",setup(b){const ca=a(!1),ia=a([]),ra=a({total_records:0,total_students:0,present_count:0,absent_count:0,sick_count:0,permission_count:0,attendance_percentage:0}),da=a({start_date:"",end_date:"",month:"",academic_year_id:"",teacher_id:"",class_id:""}),oa=a({current_page:1,per_page:15,total:0,last_page:1}),ua=async(a=1)=>{ca.value=!0;try{const e={...da.value,page:a,per_page:oa.value.per_page};Object.keys(e).forEach(a=>{e[a]||delete e[a]});const{ok:s,data:t,error:l}=await h("reports/student-attendance",{method:"GET",params:e});s?(ia.value=t.data.attendances.data||[],oa.value={current_page:t.data.attendances.current_page,per_page:t.data.attendances.per_page,total:t.data.attendances.total,last_page:t.data.attendances.last_page}):k(l)}catch(e){k(e.message)}finally{ca.value=!1}},va=e(()=>da.value.class_id?ia.value.filter(a=>a.class_id===da.value.class_id):ia.value),pa=async()=>{try{const a={...da.value};Object.keys(a).forEach(e=>{a[e]||delete a[e]});const{ok:e,data:s,error:t}=await h("reports/student-attendance/summary",{method:"GET",params:a});e&&(ra.value=s.data.summary)}catch(a){}},ga=async()=>{oa.value.current_page=1,await Promise.all([ua(1),pa()])},ma=()=>{da.value={start_date:"",end_date:"",month:"",academic_year_id:"",teacher_id:"",class_id:""},ia.value=[],ra.value={total_records:0,total_students:0,present_count:0,absent_count:0,sick_count:0,permission_count:0,attendance_percentage:0}},_a=a=>{a>=1&&a<=oa.value.last_page&&ua(a)},ba=a=>a?{present:a.filter(a=>"hadir"===a.status).length,sick:a.filter(a=>"sakit"===a.status).length,permission:a.filter(a=>"ijin"===a.status).length,absent:a.filter(a=>"alpa"===a.status).length}:{present:0,sick:0,permission:0,absent:0},fa=e(()=>ia.value.length>0),ha=e(()=>Object.keys(da.value).filter(a=>da.value[a]).length>0);return s(()=>{const a=new Date;da.value.start_date=a.toISOString().split("T")[0],da.value.end_date=a.toISOString().split("T")[0],ga()}),(a,e)=>(_(),t(u,null,[e[16]||(e[16]=l('<section class="content-header" data-v-a27545eb><div class="container-fluid" data-v-a27545eb><div class="row" data-v-a27545eb><div class="col-sm-6" data-v-a27545eb><h4 class="font-serif-formal" data-v-a27545eb>Laporan Absensi Siswa</h4></div><div class="col-sm-6" data-v-a27545eb><ol class="breadcrumb float-sm-right" data-v-a27545eb><li class="breadcrumb-item" data-v-a27545eb><a href="#" data-v-a27545eb>Laporan</a></li><li class="breadcrumb-item active" data-v-a27545eb>Absensi Siswa</li></ol></div></div></div></section>',1)),n("section",w,[n("div",S,[c(y,{modelValue:da.value,"onUpdate:modelValue":e[0]||(e[0]=a=>da.value=a),onApply:ga,onReset:ma},null,8,["modelValue"]),fa.value?(_(),t("div",T,[n("div",j,[n("div",E,[n("div",A,[n("h3",null,r(ra.value.total_records),1),e[3]||(e[3]=n("p",null,"Total Sesi Kelas",-1))]),e[4]||(e[4]=n("div",{class:"icon"},[n("i",{class:"fas fa-chalkboard"})],-1))])]),n("div",I,[n("div",O,[n("div",C,[n("h3",null,r(ra.value.present_count),1),e[5]||(e[5]=n("p",null,"Total Hadir",-1))]),e[6]||(e[6]=n("div",{class:"icon"},[n("i",{class:"fas fa-user-check"})],-1))])]),n("div",D,[n("div",G,[n("div",H,[n("h3",null,r(ra.value.sick_count+ra.value.permission_count),1),e[7]||(e[7]=n("p",null,"Sakit / Izin",-1))]),e[8]||(e[8]=n("div",{class:"icon"},[n("i",{class:"fas fa-notes-medical"})],-1))])]),n("div",K,[n("div",L,[n("div",V,[n("h3",null,r(ra.value.absent_count),1),e[9]||(e[9]=n("p",null,"Tidak Hadir (Alpha)",-1))]),e[10]||(e[10]=n("div",{class:"icon"},[n("i",{class:"fas fa-user-times"})],-1))])])])):i("",!0),n("div",z,[n("div",F,[n("div",P,[n("div",B,[e[11]||(e[11]=n("h3",{class:"card-title font-serif-formal"},[n("i",{class:"fas fa-table mr-2"}),d(" Data Absensi Siswa ")],-1)),n("div",M,[fa.value?(_(),o(x,{key:0,filters:da.value,"report-type":"student-attendance"},null,8,["filters"])):i("",!0)])]),n("div",N,[ca.value?(_(),t("div",R,[...e[12]||(e[12]=[n("i",{class:"fas fa-spinner fa-spin fa-3x text-navy"},null,-1),n("p",{class:"mt-3"},"Memuat data...",-1)])])):fa.value?(_(),t("table",U,[e[14]||(e[14]=n("thead",null,[n("tr",null,[n("th",{style:{width:"5%"}},"No"),n("th",null,"Tanggal"),n("th",null,"Kelas"),n("th",null,"Guru Pengajar"),n("th",{class:"text-center"},"Hadir"),n("th",{class:"text-center"},"Sakit"),n("th",{class:"text-center"},"Izin"),n("th",{class:"text-center"},"Alpha")])],-1)),n("tbody",null,[(_(!0),t(u,null,v(va.value,(a,s)=>{var l,c;return _(),t("tr",{key:a.id},[n("td",q,r((oa.value.current_page-1)*oa.value.per_page+s+1),1),n("td",null,[e[13]||(e[13]=n("i",{class:"fas fa-calendar-day mr-1 text-muted"},null,-1)),d(" "+r(p(f)(a.date)),1)]),n("td",null,[n("strong",null,r((null==(l=a.classroom)?void 0:l.name)||"-"),1)]),n("td",null,r((null==(c=a.teacher)?void 0:c.name)||"-"),1),n("td",J,[n("span",Q,r(ba(a.details).present),1)]),n("td",W,[n("span",X,r(ba(a.details).sick),1)]),n("td",Y,[n("span",Z,r(ba(a.details).permission),1)]),n("td",$,[n("span",aa,r(ba(a.details).absent),1)])])}),128))])])):(_(),t("div",ea,[e[15]||(e[15]=n("i",{class:"fas fa-inbox fa-3x text-muted mb-3"}," Data Kosong",-1)),n("p",sa,r(ha.value?"Tidak ada data untuk filter yang dipilih":'Silakan pilih filter dan klik "Tampilkan Laporan"'),1)]))]),fa.value&&oa.value.last_page>1?(_(),t("div",ta,[n("ul",la,[n("li",{class:g(["page-item",{disabled:1===oa.value.current_page}])},[n("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=m(a=>_a(oa.value.current_page-1),["prevent"]))},"«")],2),(_(!0),t(u,null,v(oa.value.last_page,a=>(_(),t("li",{key:a,class:g(["page-item",{active:oa.value.current_page===a}])},[n("a",{class:"page-link",href:"#",onClick:m(e=>_a(a),["prevent"])},r(a),9,na)],2))),128)),n("li",{class:g(["page-item",{disabled:oa.value.current_page===oa.value.last_page}])},[n("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=m(a=>_a(oa.value.current_page+1),["prevent"]))},"»")],2)])])):i("",!0)])])])])])],64))}},[["__scopeId","data-v-a27545eb"]]);export{ca as default};
